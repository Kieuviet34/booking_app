{% extends "base.html" %}
{% block title %}Đăng ký{% endblock %}

{% block content %}
<h2 class="mb-4 text-center">Đăng ký</h2>
<div class="row justify-content-center">
  <div class="col-md-6">
    <form method="POST">
      {{ form.hidden_tag() }}
      
      <!-- Username -->
      <div class="mb-3">
        {{ form.username.label(class="form-label") }}
        {{ form.username(class="form-control", placeholder="Tên đăng nhập") }}
        {% for error in form.username.errors %}
          <div class="text-danger">{{ error }}</div>
        {% endfor %}
      </div>
      
      <!-- Email -->
      <div class="mb-3">
        {{ form.email.label(class="form-label") }}
        {{ form.email(class="form-control", placeholder="Email") }}
        {% for error in form.email.errors %}
          <div class="text-danger">{{ error }}</div>
        {% endfor %}
      </div>
      
      <!-- Phone -->
      <div class="mb-3">
        {{ form.phone.label(class="form-label") }}
        {{ form.phone(class="form-control", placeholder="Số điện thoại") }}
        {% for error in form.phone.errors %}
          <div class="text-danger">{{ error }}</div>
        {% endfor %}
      </div>
      
      <!-- Address -->
      <div class="mb-3">
        {{ form.address.label(class="form-label") }}
        {{ form.address(class="form-control", placeholder="Địa chỉ") }}
        {% for error in form.address.errors %}
          <div class="text-danger">{{ error }}</div>
        {% endfor %}
      </div>
      
      <!-- Password -->
      <div class="mb-3">
        {{ form.password.label(class="form-label") }}
        {{ form.password(class="form-control", placeholder="Mật khẩu") }}
        {% for error in form.password.errors %}
          <div class="text-danger">{{ error }}</div>
        {% endfor %}
      </div>
      
      <!-- Confirm Password -->
      <div class="mb-3">
        {{ form.confirm_password.label(class="form-label") }}
        {{ form.confirm_password(class="form-control", placeholder="Xác nhận mật khẩu") }}
        {% for error in form.confirm_password.errors %}
          <div class="text-danger">{{ error }}</div>
        {% endfor %}
      </div>
      
      <!-- Checkbox hiển thị mật khẩu -->
      <div class="form-check mb-3">
        <input type="checkbox" class="form-check-input" id="showPassword">
        <label class="form-check-label" for="showPassword">Hiển thị mật khẩu</label>
      </div>
      
      <!-- Submit button -->
      <button type="submit" class="btn btn-primary w-100">{{ form.submit.label.text }}</button>
    </form>
  </div>
</div>

<!-- Modal thông báo thành công -->
<div class="modal fade" id="successModal" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="successModalLabel">Đăng ký thành công</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Đóng"></button>
      </div>
      <div class="modal-body">
        Tài khoản của bạn đã được tạo thành công. Vui lòng đăng nhập để tiếp tục.
      </div>
      <div class="modal-footer">
        <a href="/auth/login" class="btn btn-primary">Đăng nhập ngay</a>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script>
    // Toggle hiển thị mật khẩu cho password và confirm_password
    document.getElementById('showPassword').addEventListener('change', function() {
      var pwdField = document.getElementById('{{ form.password.id }}');
      var confirmPwdField = document.getElementById('{{ form.confirm_password.id }}');
      if (this.checked) {
        pwdField.type = 'text';
        confirmPwdField.type = 'text';
      } else {
        pwdField.type = 'password';
        confirmPwdField.type = 'password';
      }
    });

    // Hiển thị modal thành công nếu registration_success được truyền từ backend là true
    var registrationSuccess = "{{ registration_success|default('false')|tojson }}";
    if (registrationSuccess) {
      var successModal = new bootstrap.Modal(document.getElementById('successModal'));
      successModal.show();
    }
  </script>
{% endblock %}
